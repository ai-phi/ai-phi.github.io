---
export interface Props {
  src: string;
  title?: string;
  width?: string;
  height?: string;
  showDownload?: boolean;
}

const {
  src,
  title = "PDF Document",
  width = "100%",
  height = "600px",
  showDownload = true,
} = Astro.props;
---

<div class="pdf-viewer-container">
  <div class="pdf-viewer">
    <!-- Mobile fallback - show preview image and link instead of iframe -->
    <div class="mobile-pdf-fallback">
      <div class="pdf-preview">
        <div class="pdf-icon">üìÑ</div>
        <h4 class="pdf-title-mobile">{title}</h4>
        <p class="pdf-description">PDF Document</p>
        <div class="mobile-pdf-actions">
          <a
            href={src}
            target="_blank"
            rel="noopener noreferrer"
            class="mobile-pdf-btn view-btn"
          >
            üëÅÔ∏è View PDF
          </a>
          {
            showDownload && (
              <a href={src} download class="mobile-pdf-btn download-btn">
                ‚¨áÔ∏è Download
              </a>
            )
          }
        </div>
      </div>
    </div>

    <!-- Desktop PDF viewer -->
    <div class="desktop-pdf-viewer">
      <iframe
        src={`${src}#toolbar=0&navpanes=0&scrollbar=1&view=FitH`}
        width={width}
        height={height}
        class="pdf-iframe"
        title={title}
        loading="lazy"
        frameborder="0"
        allowfullscreen
      >
        <div class="pdf-fallback"> <p>Your browser doesn't support PDF
        viewing.</p> {showDownload && ( <a href={src} download
        class="pdf-download-btn"> üìÑ Download PDF </a> )} <p><a href={src}
        target="_blank" rel="noopener noreferrer">Open PDF in new tab</a></p>
        </div>
      </iframe>
    </div>
  </div>
</div>

<style>
  .pdf-viewer-container {
    @apply relative p-2.5;
    /* Debug: Add visible border to check container */
    /* border: 2px solid red; */
  }

  .pdf-title {
    @apply mb-4 text-xl font-semibold text-skin-accent;
  }

  .pdf-viewer {
    @apply overflow-hidden rounded-lg border border-skin-line shadow-lg;
  }

  .pdf-iframe {
    @apply border-0;
    /* Enable smooth scrolling on mobile */
    -webkit-overflow-scrolling: touch;
    overflow: auto;
  }

  /* Mobile-specific PDF handling */
  @media (max-width: 768px) {
    .pdf-viewer {
      /* Allow touch scrolling */
      overflow: visible;
      position: relative;
    }

    .pdf-iframe {
      /* Improve mobile scrolling */
      -webkit-overflow-scrolling: touch;
      overflow: auto;
      touch-action: pan-x pan-y;
      /* Ensure proper sizing on mobile */
      width: 100% !important;
      min-height: 400px;
    }
  }

  /* Very small screens - make PDFs more accessible */
  @media (max-width: 480px) {
    .pdf-iframe {
      min-height: 350px;
    }
  }

  /* Device toolbar/emulation mode fixes */
  @media screen and (max-device-width: 768px) {
    .pdf-iframe {
      /* Ensure iframe loads properly in device emulation */
      max-width: 100%;
      height: auto;
      min-height: 400px;
    }
  }

  .pdf-fallback {
    @apply bg-skin-fill p-8 text-center;
  }

  /* Mobile PDF fallback styling */
  .mobile-pdf-fallback {
    @apply hidden;
  }

  .pdf-preview {
    @apply rounded-lg border border-skin-line bg-skin-card p-6 text-center;
    min-height: 380px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    /* Temporary debug border */
    border: 3px solid #ff0000 !important;
  }

  .pdf-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.7;
  }

  .pdf-title-mobile {
    @apply mb-2 text-lg font-semibold text-skin-base;
  }

  .pdf-description {
    @apply mb-4 text-sm text-skin-base opacity-70;
  }

  .mobile-pdf-actions {
    @apply flex flex-wrap justify-center gap-3;
  }

  .mobile-pdf-btn {
    @apply rounded-lg px-4 py-2 text-sm font-medium transition-colors;
  }

  .view-btn {
    @apply bg-skin-accent text-skin-inverted hover:bg-opacity-80;
  }

  .download-btn {
    @apply border border-skin-accent text-skin-accent hover:bg-skin-accent hover:text-skin-inverted;
  }

  /* Desktop PDF viewer - show by default */
  .desktop-pdf-viewer {
    @apply block;
  }

  /* Mobile devices - show fallback instead of iframe */
  @media (max-width: 768px) {
    .mobile-pdf-fallback {
      @apply block !important;
    }

    .desktop-pdf-viewer {
      @apply hidden !important;
    }
  }

  /* Also target device toolbar specifically */
  @media screen and (max-device-width: 768px) {
    .mobile-pdf-fallback {
      @apply block !important;
    }

    .desktop-pdf-viewer {
      @apply hidden !important;
    }
  }
</style>
